<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
   xmlns:util="http://schemas.microsoft.com/wix/UtilExtension" >

   <?include $(sys.CURRENTDIR)\Common.wxi?>

   <?define NewPlusAssetsFiles=LargeTile.png;New_dark.ico;New_light.ico;Open_templates_dark.ico;Open_templates_light.ico;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;StoreLogo.png;Wide310x150Logo.pngLargeTile.png;New_dark.ico;New_light.ico;Open_templates_dark.ico;Open_templates_light.ico;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;StoreLogo.png;Wide310x150Logo.pngLargeTile.png;New_dark.ico;New_light.ico;Open_templates_dark.ico;Open_templates_light.ico;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;StoreLogo.png;Wide310x150Logo.pngLargeTile.png;New_dark.ico;New_light.ico;Open_templates_dark.ico;Open_templates_light.ico;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;StoreLogo.png;Wide310x150Logo.pngLargeTile.png;New_dark.ico;New_light.ico;Open_templates_dark.ico;Open_templates_light.ico;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;StoreLogo.png;Wide310x150Logo.png?>
   <?define NewPlusAssetsFilesPath=$(var.BinDir)WinUI3Apps\Assets\NewPlus\?>
   <?define NewPlusTemplateFilesPath=$(var.BinDir)WinUI3Apps\Assets\NewPlus\Templates\?>
   <?define NewPlusTemplateSubFilesPath=$(var.BinDir)WinUI3Apps\Assets\NewPlus\Templates\Example folder\?>

   <Fragment>

      <!-- Assets -->
      <DirectoryRef Id="WinUI3AppsAssetsFolder">
         <Directory Id="NewPlusAssetsInstallFolder" Name="NewPlus" />
      </DirectoryRef>
      <DirectoryRef Id="NewPlusAssetsInstallFolder" FileSource="$(var.NewPlusAssetsFilesPath)">
         <!-- Generated by generateFileComponents.ps1 -->

            <Component Id="NewPlusAssetsFiles_Component" Win64="yes" Guid="CC9AE0DD-8911-4C2B-A379-9B351F617903">
              <RegistryKey Root="HKLM" Key="Software\Classes\powertoys\components">
                <RegistryValue Type="string" Name="NewPlusAssetsFiles_Component" Value="" KeyPath="yes"/>
              </RegistryKey>
              <File Id="NewPlusAssetsFiles_File_LargeTile.png" Source="$(var.NewPlusAssetsFilesPath)\LargeTile.png" />
              <File Id="NewPlusAssetsFiles_File_New_dark.ico" Source="$(var.NewPlusAssetsFilesPath)\New_dark.ico" />
              <File Id="NewPlusAssetsFiles_File_New_light.ico" Source="$(var.NewPlusAssetsFilesPath)\New_light.ico" />
              <File Id="NewPlusAssetsFiles_File_Open_templates_dark.ico" Source="$(var.NewPlusAssetsFilesPath)\Open_templates_dark.ico" />
              <File Id="NewPlusAssetsFiles_File_Open_templates_light.ico" Source="$(var.NewPlusAssetsFilesPath)\Open_templates_light.ico" />
              <File Id="NewPlusAssetsFiles_File_SmallTile.png" Source="$(var.NewPlusAssetsFilesPath)\SmallTile.png" />
              <File Id="NewPlusAssetsFiles_File_SplashScreen.png" Source="$(var.NewPlusAssetsFilesPath)\SplashScreen.png" />
              <File Id="NewPlusAssetsFiles_File_Square150x150Logo.png" Source="$(var.NewPlusAssetsFilesPath)\Square150x150Logo.png" />
              <File Id="NewPlusAssetsFiles_File_Square44x44Logo.png" Source="$(var.NewPlusAssetsFilesPath)\Square44x44Logo.png" />
              <File Id="NewPlusAssetsFiles_File_StoreLogo.png" Source="$(var.NewPlusAssetsFilesPath)\StoreLogo.png" />
              <File Id="NewPlusAssetsFiles_File_Wide310x150Logo.png" Source="$(var.NewPlusAssetsFilesPath)\Wide310x150Logo.png" />
            </Component>

         
         <!-- NewPlus Shell Extension for Win10 registration -->
         <Component Id="NewPlus_ShellExtension_win10" Guid="D5456D4A-6EEC-4B85-944D-6A6A4A74FFA6" Win64="yes">
            <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\CLSID\{FF90D477-E32A-4BE8-8CC5-A502A97F5401}">
               <RegistryValue Type="string" Value="NewPlus Shell Extension Win10" />
               <RegistryValue Type="string" Name="ContextMenuOptIn" Value="" />
               <RegistryValue Type="string" Key="InprocServer32" Value="[WinUI3AppsInstallFolder]PowerToys.NewPlus.ShellExtension.win10.dll" />
               <RegistryValue Type="string" Key="InprocServer32" Name="ThreadingModel" Value="Apartment" />
            </RegistryKey>
            <RegistryKey Root="$(var.RegistryScope)" Key="SOFTWARE\Classes\Directory\background\ShellEx\ContextMenuHandlers\NewPlusShellExtensionWin10">
               <RegistryValue Type="string" Value="{FF90D477-E32A-4BE8-8CC5-A502A97F5401}"/>
            </RegistryKey>
         </Component>
      </DirectoryRef>

      <ComponentGroup Id="NewPlusComponentGroup">
         <Component Id="RemoveNewPlusFolder" Guid="4189C789-56EB-409D-912E-3F4F3F4F1FFA" Directory="NewPlusAssetsInstallFolder" >
            <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
               <RegistryValue Type="string" Name="RemoveNewPlusFolder" Value="" KeyPath="yes"/>
            </RegistryKey>
            <RemoveFolder Id="RemoveFolderNewPlusAssetsFolder" Directory="NewPlusAssetsInstallFolder" On="uninstall"/>
         </Component>
         <ComponentRef Id="NewPlus_ShellExtension_win10" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
    </ComponentGroup>

      
      <!-- Example templates -->
      <DirectoryRef Id="WinUI3AppsAssetsFolder">
         <Directory Id="NewPlusInstallFolder" Name="NewPlus">
            <Directory Id="NewPlusTemplatesInstallFolder" Name="Templates">
               <Directory Id="NewPlusTemplatesSubInstallFolder" Name="Example folder"/>
            </Directory>
         </Directory>
      </DirectoryRef>
      <DirectoryRef Id="NewPlusTemplatesInstallFolder" FileSource="$(var.NewPlusTemplateFilesPath)">
         <Component Id="NewPlusTemplateFiles_Component" Win64="yes" Guid="39264075-4B7F-40E3-A76F-21E68576D43E">
            <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
               <RegistryValue Type="string" Name="NewPlusTemplateFiles_Component" Value="" KeyPath="yes"/>
            </RegistryKey>
            <File Id="NewPlusTemplateFiles_File_1.md" Source="$(var.NewPlusTemplateFilesPath)Any files or folders placed in the template folder are available via New+.txt" />
         </Component>
      </DirectoryRef>
      <DirectoryRef Id="NewPlusTemplatesSubInstallFolder" FileSource="$(var.NewPlusTemplateSubFilesPath)">
         <Component Id="NewPlusTemplateSubFiles_Component" Win64="yes" Guid="7618E61C-CCB8-492F-B284-E1AE2954AF0B">
            <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
               <RegistryValue Type="string" Name="NewPlusTemplateSubFiles_Component" Value="" KeyPath="yes"/>
            </RegistryKey>
            <File Id="NewPlusTemplateSubFiles_File_1.md" Source="$(var.NewPlusTemplateSubFilesPath)Example txt file.txt" />
            <File Id="NewPlusTemplateSubFiles_File_2.md" Source="$(var.NewPlusTemplateSubFilesPath)Another example txt file.txt" />
         </Component>
      </DirectoryRef>

      <ComponentGroup Id="NewPlusTemplatesComponentGroup">
         <Component Id="RemoveNewPlusTemplateFolder" Guid="3E9B15CA-A50C-42DA-977F-5E9914562FE7" Directory="NewPlusInstallFolder" >
            <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
               <RegistryValue Type="string" Name="RemoveNewPlusTemplateFolder" Value="" KeyPath="yes"/>
            </RegistryKey>
            <RemoveFolder Id="RemoveFolderNewPlusInstallFolder" Directory="NewPlusInstallFolder" On="uninstall"/>
            <RemoveFolder Id="RemoveFolderNewPlusTemplatesInstallFolder" Directory="NewPlusTemplatesInstallFolder" On="uninstall"/>
            <RemoveFolder Id="RemoveFolderNewPlusTemplatesSubInstallFolder" Directory="NewPlusTemplatesSubInstallFolder" On="uninstall"/>
         </Component>
         <ComponentRef Id="NewPlusTemplateFiles_Component" />
         <ComponentRef Id="NewPlusTemplateSubFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
            <ComponentRef Id="NewPlusAssetsFiles_Component" />
    </ComponentGroup>

   </Fragment>
</Wix>
