<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension" >

  <?include $(sys.CURRENTDIR)\Common.wxi?>

  <?define ImageResizerAssetsFiles=ImageResizer.ico;LargeTile.png;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;storelogo.png;Wide310x150Logo.pngImageResizer.ico;LargeTile.png;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;storelogo.png;Wide310x150Logo.pngImageResizer.ico;LargeTile.png;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;storelogo.png;Wide310x150Logo.pngImageResizer.ico;LargeTile.png;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;storelogo.png;Wide310x150Logo.pngImageResizer.ico;LargeTile.png;SmallTile.png;SplashScreen.png;Square150x150Logo.png;Square44x44Logo.png;storelogo.png;Wide310x150Logo.png?>
  <?define ImageResizerAssetsFilesPath=$(var.BinDir)Assets\ImageResizer\?>

  <Fragment>
    <DirectoryRef Id="BaseApplicationsAssetsFolder">
      <Directory Id="ImageResizerAssetsFolder" Name="ImageResizer" />
    </DirectoryRef>

    <DirectoryRef Id="ImageResizerAssetsFolder" FileSource="$(var.ImageResizerAssetsFilesPath)">
    <!-- Generated by generateFileComponents.ps1 -->

            <Component Id="ImageResizerAssetsFiles_Component" Win64="yes" Guid="48C6CBEC-9A0D-40A8-86A6-DC59A4ADFB63">
              <RegistryKey Root="HKLM" Key="Software\Classes\powertoys\components">
                <RegistryValue Type="string" Name="ImageResizerAssetsFiles_Component" Value="" KeyPath="yes"/>
              </RegistryKey>
              <File Id="ImageResizerAssetsFiles_File_ImageResizer.ico" Source="$(var.ImageResizerAssetsFilesPath)\ImageResizer.ico" />
              <File Id="ImageResizerAssetsFiles_File_LargeTile.png" Source="$(var.ImageResizerAssetsFilesPath)\LargeTile.png" />
              <File Id="ImageResizerAssetsFiles_File_SmallTile.png" Source="$(var.ImageResizerAssetsFilesPath)\SmallTile.png" />
              <File Id="ImageResizerAssetsFiles_File_SplashScreen.png" Source="$(var.ImageResizerAssetsFilesPath)\SplashScreen.png" />
              <File Id="ImageResizerAssetsFiles_File_Square150x150Logo.png" Source="$(var.ImageResizerAssetsFilesPath)\Square150x150Logo.png" />
              <File Id="ImageResizerAssetsFiles_File_Square44x44Logo.png" Source="$(var.ImageResizerAssetsFilesPath)\Square44x44Logo.png" />
              <File Id="ImageResizerAssetsFiles_File_storelogo.png" Source="$(var.ImageResizerAssetsFilesPath)\storelogo.png" />
              <File Id="ImageResizerAssetsFiles_File_Wide310x150Logo.png" Source="$(var.ImageResizerAssetsFilesPath)\Wide310x150Logo.png" />
            </Component>


      <Component Id="Module_ImageResizer_Registry" Win64="yes">
        <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\CLSID\{51B4D7E5-7568-4234-B4BB-47FB3C016A69}\InprocServer32">
          <RegistryValue Value="[INSTALLFOLDER]PowerToys.ImageResizerExt.dll" Type="string" />
          <RegistryValue Name="ThreadingModel" Value="Apartment" Type="string" />
        </RegistryKey>

        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\Directory\ShellEx\DragDropHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <!-- Registry Keys for the context menu handler for each of the following image formats: bmp, dib, gif, jfif, jpe, jpeg, jpg, jxr, png, rle, tif, tiff, wdp  -->
        <RegistryValue Root="$(var.RegistryScope)"
                          Key="SOFTWARE\Classes\SystemFileAssociations\.bmp\ShellEx\ContextMenuHandlers\ImageResizer"
                          Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                          Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.dib\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.gif\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.jfif\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.jpe\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.jpeg\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.jpg\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.jxr\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.png\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.rle\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.tif\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.tiff\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
        <RegistryValue Root="$(var.RegistryScope)"
                        Key="SOFTWARE\Classes\SystemFileAssociations\.wdp\ShellEx\ContextMenuHandlers\ImageResizer"
                        Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                        Type="string" />
      </Component>

    </DirectoryRef>

    <ComponentGroup Id="ImageResizerComponentGroup">
      <Component Id="RemoveImageResizerFolder" Guid="8E5DE86A-8618-4590-9584-51BCD3A14280" Directory="ImageResizerAssetsFolder" >
        <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
          <RegistryValue Type="string" Name="RemoveImageResizerFolder" Value="" KeyPath="yes"/>
        </RegistryKey>
        <RemoveFolder Id="RemoveFolderImageResizerAssetsFolder" Directory="ImageResizerAssetsFolder" On="uninstall"/>
      </Component>
      <ComponentRef Id="Module_ImageResizer_Registry" />
            <ComponentRef Id="ImageResizerAssetsFiles_Component" />
            <ComponentRef Id="ImageResizerAssetsFiles_Component" />
            <ComponentRef Id="ImageResizerAssetsFiles_Component" />
            <ComponentRef Id="ImageResizerAssetsFiles_Component" />
            <ComponentRef Id="ImageResizerAssetsFiles_Component" />
    </ComponentGroup>
  </Fragment>
</Wix>
